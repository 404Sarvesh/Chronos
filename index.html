<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chronos Elite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=JetBrains+Mono:wght@800&display=swap" rel="stylesheet">
    <style>
        :root {
            --neon-primary: #ffffff; /* Contrast color: white or black */
            --space-bg: #020205;
            --glass: rgba(128, 128, 128, 0.15);
            --glow-strength: 20px;
            --glow-particle: 8px;
        }

        body {
            background-color: var(--space-bg);
            color: var(--neon-primary);
            font-family: 'Orbitron', sans-serif;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.4s ease, color 0.4s ease;
        }

        #canvas-container {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 0;
            pointer-events: none;
        }

        #space-canvas { width: 100%; height: 100%; display: block; }

        .timer-display {
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'JetBrains Mono', monospace;
            font-size: clamp(3rem, 18vw, 15rem);
            font-weight: 800;
            z-index: 10;
            pointer-events: none;
            text-shadow: 0 0 var(--glow-strength) var(--neon-primary);
            color: var(--neon-primary);
            width: 100%;
            line-height: 1;
            transition: text-shadow 0.2s ease, color 0.4s ease;
        }

        .stealth-active .timer-display {
            text-shadow: 0 0 calc(var(--glow-strength) / 2) var(--neon-primary);
        }

        .unit-group {
            width: 2.1ch;
            text-align: center;
            display: inline-block;
        }

        .colon-box {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 10ch;
            width: 1ch;
            gap: 1.2rem;
            opacity: 0.4;
            margin: 0 0.2rem;
        }
        
        .colon-dot {
            width: 0.8vw;
            height: 0.8vw;
            min-width: 8px;
            min-height: 8px;
            background-color: var(--neon-primary);
            border-radius: 50%;
            box-shadow: 0 0 var(--glow-particle) var(--neon-primary);
            transition: background-color 0.4s ease, box-shadow 0.2s ease;
        }

        #controls {
            position: fixed;
            bottom: 3vh;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            width: 90%;
            max-width: 400px;
            background: var(--glass);
            backdrop-filter: blur(25px);
            padding: 1rem;
            border-radius: 1.5rem;
            border: 1px solid rgba(128, 128, 128, 0.3);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
            transition: opacity 0.4s ease, transform 0.4s ease, color 0.4s ease;
            color: var(--neon-primary);
        }

        .stealth-active #controls, 
        .stealth-active .utility-bar,
        .stealth-active #settings-trigger {
            opacity: 0;
            transform: translateY(20px) translateX(-50%);
            pointer-events: none;
        }
        
        .stealth-active .utility-bar { transform: translateY(-20px); }
        .stealth-active #settings-trigger { transform: translateY(20px); }

        .utility-bar, #settings-trigger {
            position: fixed;
            z-index: 100;
            transition: all 0.4s ease;
        }
        .utility-bar { top: 20px; right: 20px; }
        #settings-trigger { bottom: 20px; right: 20px; z-index: 110; }

        .btn-icon {
            width: 44px;
            height: 44px;
            background: var(--glass);
            border: 1px solid rgba(128, 128, 128, 0.3);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--neon-primary);
            transition: all 0.2s ease;
        }

        #settings-panel {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 240px;
            background: var(--glass);
            backdrop-filter: blur(30px);
            border-radius: 1.2rem;
            border: 1px solid rgba(128, 128, 128, 0.3);
            padding: 1.2rem;
            z-index: 120;
            display: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.4);
            color: var(--neon-primary);
        }

        #settings-panel.open { display: block; animation: slideUp 0.2s ease-out; }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .setting-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            font-weight: 700;
            opacity: 0.8;
            margin-bottom: 0.5rem;
            display: block;
            color: var(--neon-primary);
        }

        .range-slider {
            width: 100%;
            height: 6px;
            -webkit-appearance: none;
            background: rgba(128, 128, 128, 0.3);
            border-radius: 10px;
            outline: none;
            margin: 10px 0;
        }

        .range-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: var(--neon-primary);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }

        .color-picker-custom {
            width: 100%;
            height: 40px;
            border: 1px solid rgba(128,128,128,0.3);
            border-radius: 8px;
            background: rgba(128,128,128,0.1);
            cursor: pointer;
            padding: 4px;
        }

        .setter-column {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(128,128,128,0.1);
            padding: 6px 10px;
            border-radius: 12px;
            border: 1px solid rgba(128,128,128,0.2);
            color: var(--neon-primary);
        }

        .adjust-btn {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(128,128,128,0.15);
            border-radius: 6px;
            font-weight: bold;
            color: var(--neon-primary);
            transition: all 0.2s;
        }
        .adjust-btn:hover { background: var(--neon-primary); color: var(--space-bg); }

        .launch-btn {
            background: var(--neon-primary);
            color: var(--space-bg);
            font-weight: 900;
            padding: 12px;
            border-radius: 12px;
            width: 100%;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-size: 0.9rem;
            transition: all 0.4s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .cursor-hidden { cursor: none !important; }
    </style>
</head>
<body>

    <div class="utility-bar">
        <button class="btn-icon" onclick="toggleFullscreen()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7"/></svg>
        </button>
    </div>

    <div id="settings-trigger">
        <button class="btn-icon" onclick="toggleSettings()">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
        </button>
    </div>

    <div id="settings-panel">
        <div class="mb-4">
            <label class="setting-label">Glow Intensity</label>
            <input type="range" id="glowSlider" class="range-slider" min="0" max="60" value="20">
        </div>
        <div class="mb-4">
            <label class="setting-label">Background Color</label>
            <input type="color" id="bgColorPicker" class="color-picker-custom" value="#020205">
        </div>
        <button onclick="toggleSettings()" class="w-full text-[10px] font-bold uppercase opacity-60 mt-1 tracking-widest">Done</button>
    </div>

    <div id="canvas-container">
        <canvas id="space-canvas"></canvas>
    </div>

    <div id="display" class="timer-display">
        <div class="unit-group" id="h">00</div>
        <div class="colon-box">
            <div class="colon-dot"></div>
            <div class="colon-dot"></div>
        </div>
        <div class="unit-group" id="m">05</div>
        <div class="colon-box">
            <div class="colon-dot"></div>
            <div class="colon-dot"></div>
        </div>
        <div class="unit-group" id="s">00</div>
    </div>

    <div id="controls">
        <div class="grid grid-cols-3 gap-2 mb-3">
            <div class="setter-column">
                <button class="adjust-btn" onclick="adj('hr', -1)">-</button>
                <div class="val-display" id="hrVal">00</div>
                <button class="adjust-btn" onclick="adj('hr', 1)">+</button>
            </div>
            <div class="setter-column">
                <button class="adjust-btn" onclick="adj('min', -1)">-</button>
                <div class="val-display" id="minVal">05</div>
                <button class="adjust-btn" onclick="adj('min', 1)">+</button>
            </div>
            <div class="setter-column">
                <button class="adjust-btn" onclick="adj('sec', -1)">-</button>
                <div class="val-display" id="secVal">00</div>
                <button class="adjust-btn" onclick="adj('sec', 1)">+</button>
            </div>
        </div>

        <div class="flex gap-2">
            <button onclick="togglePlay()" id="mainBtn" class="launch-btn flex-grow">Start</button>
            <button onclick="resetTimer()" class="btn-icon">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8m0-5v5h5"/></svg>
            </button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('space-canvas');
        const ctx = canvas.getContext('2d');
        let width, height, mouseX = -2000, mouseY = -2000;
        let particles = [];
        
        let bgColor = '#020205';
        let contrastColor = '#ffffff'; 
        let timeState = { hr: 0, min: 5, sec: 0 };

        function getContrastYIQ(hexcolor){
            hexcolor = hexcolor.replace("#", "");
            const r = parseInt(hexcolor.substr(0,2),16);
            const g = parseInt(hexcolor.substr(2,2),16);
            const b = parseInt(hexcolor.substr(4,2),16);
            const yiq = ((r*299)+(g*587)+(b*114))/1000;
            return (yiq >= 128) ? '#000000' : '#ffffff';
        }

        class Particle {
            constructor() { this.init(); }
            init() {
                this.x = Math.random() * width;
                this.y = Math.random() * height;
                this.vx = (Math.random() - 0.5) * 0.4;
                this.vy = (Math.random() - 0.5) * 0.4;
                this.size = Math.random() * 1.5 + 0.6;
                this.maxLife = 200 + Math.random() * 200;
                this.life = this.maxLife;
            }
            update() {
                this.life--;
                const isStealth = document.body.classList.contains('stealth-active');
                if (!isStealth) {
                    const dx = this.x - mouseX;
                    const dy = this.y - mouseY;
                    const distSq = dx*dx + dy*dy;
                    if (distSq < 40000) { 
                        const dist = Math.sqrt(distSq);
                        const force = (1 - dist/200) * 0.6;
                        this.vx += (dx / dist) * force;
                        this.vy += (dy / dist) * force;
                    }
                }
                this.vx *= 0.985;
                this.vy *= 0.985;
                this.x += this.vx;
                this.y += this.vy;
                if (this.life <= 0 || this.x < -20 || this.x > width + 20 || this.y < -20 || this.y > height + 20) {
                    this.init();
                }
            }
            draw() {
                const isStealth = document.body.classList.contains('stealth-active');
                const alphaBase = isStealth ? 0.3 : 0.6;
                const alpha = (this.life / this.maxLife) * alphaBase; 
                ctx.fillStyle = contrastColor;
                ctx.globalAlpha = alpha;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function resize() {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
            particles = Array.from({length: 120}, () => new Particle());
        }

        function updateUI() {
            const h = timeState.hr.toString().padStart(2, '0');
            const m = timeState.min.toString().padStart(2, '0');
            const s = timeState.sec.toString().padStart(2, '0');
            document.getElementById('hrVal').innerText = h;
            document.getElementById('minVal').innerText = m;
            document.getElementById('secVal').innerText = s;
            document.getElementById('h').innerText = h;
            document.getElementById('m').innerText = m;
            document.getElementById('s').innerText = s;
        }

        function adj(unit, amount) {
            if (isRunning) return;
            timeState[unit] += amount;
            if (timeState[unit] < 0) timeState[unit] = 0;
            if (unit !== 'hr' && timeState[unit] > 59) timeState[unit] = 59;
            updateUI();
        }

        function toggleSettings() {
            document.getElementById('settings-panel').classList.toggle('open');
        }

        function setupControls() {
            const bPicker = document.getElementById('bgColorPicker');
            const gSlider = document.getElementById('glowSlider');

            bPicker.addEventListener('input', (e) => {
                bgColor = e.target.value;
                contrastColor = getContrastYIQ(bgColor);
                document.body.style.backgroundColor = bgColor;
                document.documentElement.style.setProperty('--neon-primary', contrastColor);
                document.documentElement.style.setProperty('--space-bg', bgColor);
            });

            gSlider.addEventListener('input', (e) => {
                const val = e.target.value;
                document.documentElement.style.setProperty('--glow-strength', `${val}px`);
                document.documentElement.style.setProperty('--glow-particle', `${val / 2.5}px`);
            });
        }

        function draw() {
            ctx.fillStyle = bgColor;
            ctx.globalAlpha = 1;
            ctx.fillRect(0, 0, width, height);
            particles.forEach(p => { p.update(); p.draw(); });
            requestAnimationFrame(draw);
        }

        let timerInt, isRunning = false, targetTime, remaining = null;

        function togglePlay() {
            const mainBtn = document.getElementById('mainBtn');
            if (isRunning) {
                // Currently playing, so we pause it
                isRunning = false;
                clearInterval(timerInt);
                remaining = Math.ceil((targetTime - Date.now()) / 1000);
                mainBtn.innerText = 'Resume';
            } else {
                // Currently paused or not started, so we start/resume it
                let s = remaining !== null ? remaining : (timeState.hr * 3600 + timeState.min * 60 + timeState.sec);
                if (s <= 0) return;
                targetTime = Date.now() + s * 1000;
                isRunning = true;
                mainBtn.innerText = 'Pause';
                timerInt = setInterval(() => {
                    const diff = Math.max(0, Math.ceil((targetTime - Date.now()) / 1000));
                    const hr = Math.floor(diff/3600), min = Math.floor((diff%3600)/60), sec = diff%60;
                    document.getElementById('h').innerText = hr.toString().padStart(2, '0');
                    document.getElementById('m').innerText = min.toString().padStart(2, '0');
                    document.getElementById('s').innerText = sec.toString().padStart(2, '0');
                    if (diff <= 0) resetTimer();
                }, 100);
            }
        }

        function resetTimer() {
            isRunning = false;
            clearInterval(timerInt);
            remaining = null;
            document.getElementById('mainBtn').innerText = 'Start';
            updateUI();
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) document.documentElement.requestFullscreen();
            else document.exitFullscreen();
        }

        let idleTimer;
        function resetIdle() {
            document.body.classList.remove('stealth-active', 'cursor-hidden');
            clearTimeout(idleTimer);
            if (isRunning) {
                idleTimer = setTimeout(() => {
                    if (!document.getElementById('settings-panel').classList.contains('open')) {
                        document.body.classList.add('stealth-active', 'cursor-hidden');
                    }
                }, 800);
            }
        }

        window.onload = () => {
            resize();
            setupControls();
            updateUI();
            draw();
            window.addEventListener('resize', resize);
            window.addEventListener('mousemove', (e) => {
                mouseX = e.clientX; mouseY = e.clientY;
                resetIdle();
            });
            ['mousedown', 'keydown'].forEach(evt => window.addEventListener(evt, resetIdle));
        };
    </script>
</body>
</html>
